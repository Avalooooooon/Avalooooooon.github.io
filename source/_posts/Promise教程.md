---
title: Promise教程
updated: 2022-10-25 17:02:31
date: 2022-10-25 17:02:31
tags: [JS]
categories: [前端,JS]
---

## Production
ES6引入的异步编程的新解决方案（旧方案是单纯使用回调函数）。语法上看，<span style="color:red">**promise是一个构造函数**</span>；功能上，promise是一个对象，通常用来封装一个异步任务，提供承诺结果（其成功/失败）。
> 常见的异步编程：
> fs文件操作：```require('fs').readFile('./index.html',(err,data)=>{})```
> mysql/mangodb等数据库操作
> AJAX(jquery为例)：```$.get('/server',(data)=>{})```
> 定时器：```setTimeout(()=>{},2000)```

通俗讲，Promise是一个许诺、承诺,是对未来事情的承诺，承诺不一定能完成，但是无论是否能完成都会有一个结果。Promise 用来预定一个不一定能完成的任务，要么成功，要么失败。

Promise的状态如下，作为promise参数函数的参数时，它们自己是函数类型的数据：

+   pending：未决定的（正在做。。。）
+   resolved/fullfilled：成功（完成这个承诺）。异步任务成功时调用。
+   rejected：失败（承诺没完成，失败了）。异步任务失败时调用。

状态改变如下：

+ pending 变为 resolved
+ pending 变为 rejected
  > 只有这 2 种, 且一个 promise 对象只能改变一次。无论变为成功还是失败, 都会有一个结果数据 。成功的结果数据一般称为 value, 失败的结果数据一般称为 reason。

![promise的基本流程](liucheng.png)

优势：
1. <span style="color:red">支持链式调用，可以解决**回调地狱**问题。</span>
  
  > 回调地狱：回调函数嵌套调用，外部回调函数异步执行的结果是套在内部的回调函数执行的条件。即一层一层的嵌套，上一个方法拿到数据后在执行下一个。
  > 回调地狱的缺点：不便于阅读 + 不便于异常处理
2. 指定回调函数的方式更加灵活
  + 之前是在启动异步任务之前就必须把回调函数绑定好
  + promise可以：启动异步任务=>返回promise对象=>给promise对象绑定回调函数（甚至可以在异步任务结束后指定多个）

特点:
1. 对象的状态不受外界影响。Promise对象代表一个异步操作，有三种状态：Pending（进行中）、Resolved（已完成，又称Fulfilled）和Rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。
2. 一旦状态改变，就不会再变，任何时候都可以得到这个结果。Promise对象的状态改变，只有两种可能：从Pending变为Resolved和从Pending变为Rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果。就算改变已经发生了，你再对Promise对象添加回调函数，也会立即得到这个结果。

缺点:
1. 无法取消Promise，一旦新建它就会立即执行，无法中途取消。和一般的对象不一样，无需调用。
2. 如果不设置回调函数，Promise内部抛出的错误，不会反应到外部。
3. 当处于Pending状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）

基本使用方法如下：
```javascript

```


##
